PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE `Users` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `username` VARCHAR(255) NOT NULL UNIQUE, `salt` VARCHAR(255) NOT NULL, `pwHash` VARCHAR(255) NOT NULL, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL);
CREATE TABLE `AuthTokens` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `value` VARCHAR(255) NOT NULL UNIQUE, `loggedInAt` DATETIME, `userId` INTEGER REFERENCES `Users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL);
CREATE TABLE `Games` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `name` VARCHAR(255) NOT NULL, `ownerId` INTEGER REFERENCES `Users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL);
CREATE TABLE `Rooms` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `code` VARCHAR(255), `gameId` INTEGER REFERENCES `Games` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, `winner` INTEGER REFERENCES `Users` (`id`), `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL);
CREATE TABLE `Questions` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `question` VARCHAR(255) NOT NULL, `hint` VARCHAR(255), `index` INTEGER, `gameId` INTEGER REFERENCES `Games` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL);
CREATE TABLE `Answers` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `answer` VARCHAR(255) NOT NULL, `index` INTEGER, `correct` TINYINT(1), `questionId` INTEGER REFERENCES `Questions` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL);
CREATE TABLE `UserSessions` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `userId` INTEGER REFERENCES `Users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, `roomId` INTEGER REFERENCES `Rooms` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, UNIQUE (`userId`, `roomId`));
DELETE FROM sqlite_sequence;
INSERT INTO sqlite_sequence VALUES('Users',4);
INSERT INTO sqlite_sequence VALUES('AuthTokens',6);
INSERT INTO sqlite_sequence VALUES('Games',1);
INSERT INTO sqlite_sequence VALUES('Questions',2);
INSERT INTO sqlite_sequence VALUES('Answers',4);
INSERT INTO sqlite_sequence VALUES('Rooms',7);
COMMIT;
